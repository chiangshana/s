# å°ˆæ¡ˆçµæ§‹èªªæ˜

## ğŸ“‚ å®Œæ•´ç›®éŒ„æ¨¹

```
irtm2025-group1-webapp/
â”‚
â”œâ”€â”€ ğŸ“ frontend/                        # Next.js å‰ç«¯æ‡‰ç”¨
â”‚   â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ app/                     # Next.js App Router
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx              # æ ¹ä½ˆå±€
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx                # é¦–é ï¼ˆä¸‰æ¬„ä½ˆå±€ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ globals.css             # å…¨åŸŸæ¨£å¼
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/              # React å…ƒä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ chat-panel/          # ğŸ’¬ èŠå¤©é¢æ¿å…ƒä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatPanel.tsx       # èŠå¤©é¢æ¿å®¹å™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatHistory.tsx     # è¨Šæ¯æ­·å²åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatInput.tsx       # è¨Šæ¯è¼¸å…¥æ¡†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MessageBubble.tsx   # è¨Šæ¯æ°£æ³¡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CitationBadge.tsx   # å¼•æ–‡å¾½ç« ï¼ˆæœªä¾†ï¼‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ CitationList.tsx    # å¼•æ–‡åˆ—è¡¨ï¼ˆæœªä¾†ï¼‰
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ document-panel/      # ğŸ“„ æ–‡ä»¶ç®¡ç†é¢æ¿ï¼ˆæœªä¾†ï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DocumentPanel.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileUploader.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FileList.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ explain-panel/       # ğŸ” å¯è§£é‡‹æ€§é¢æ¿ï¼ˆæœªä¾†ï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ExplainPanel.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RewrittenQuery.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ RetrievedPassages.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ layout/              # ğŸ¨ ä½ˆå±€å…ƒä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx          # é é¦–
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ThemeToggle.tsx     # ä¸»é¡Œåˆ‡æ›
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ providers/           # ğŸ”Œ Context Providers
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Providers.tsx       # çµ±ä¸€ Provider åŒ…è£
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ ui/                  # ğŸ shadcn/ui å…ƒä»¶åº«
â”‚   â”‚   â”‚       â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ textarea.tsx
â”‚   â”‚   â”‚       â””â”€â”€ ... (13+ å…ƒä»¶)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ contexts/                # ğŸ“¦ React Context
â”‚   â”‚   â”‚   â”œâ”€â”€ SimpleChatContext.tsx   # âœ… èŠå¤©ç‹€æ…‹ç®¡ç†ï¼ˆä½¿ç”¨ä¸­ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ DocumentContext.tsx     # ğŸ“„ æ–‡ä»¶ç‹€æ…‹ï¼ˆæœªä¾†ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ ExplainContext.tsx      # ğŸ” è§£é‡‹é¢æ¿ç‹€æ…‹ï¼ˆæœªä¾†ï¼‰
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ lib/                     # ğŸ› ï¸ å·¥å…·å‡½æ•¸
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts                  # â­ API å®¢æˆ¶ç«¯ï¼ˆå‘¼å«å¾Œç«¯ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts                # å·¥å…·å‡½æ•¸
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ types/                   # ğŸ“ TypeScript é¡å‹
â”‚   â”‚       â””â”€â”€ index.ts                # ä»‹é¢å®šç¾©
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ public/                      # éœæ…‹è³‡æº
â”‚   â”‚   â””â”€â”€ *.svg                       # åœ–ç¤ºæª”æ¡ˆ
â”‚   â”‚
â”‚   â”œâ”€â”€ package.json                    # å‰ç«¯ä¾è³´
â”‚   â”œâ”€â”€ next.config.ts                  # Next.js é…ç½®
â”‚   â”œâ”€â”€ tailwind.config.ts              # Tailwind CSS é…ç½®
â”‚   â”œâ”€â”€ tsconfig.json                   # TypeScript é…ç½®
â”‚   â”œâ”€â”€ .gitignore                      # Git å¿½ç•¥è¦å‰‡
â”‚   â””â”€â”€ README.md                       # å‰ç«¯èªªæ˜æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ backend/                         # Python FastAPI å¾Œç«¯
â”‚   â”œâ”€â”€ ğŸ“ api/
â”‚   â”‚   â””â”€â”€ ğŸ“ routes/
â”‚   â”‚       â””â”€â”€ chat.py                 # â­ /api/chat ç«¯é»
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ services/                    # ğŸ§  æ¥­å‹™é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ gemini_client.py            # ğŸ¤– Gemini API å®¢æˆ¶ç«¯
â”‚   â”‚   â”œâ”€â”€ ptkb_service.py             # ğŸ’¾ PTKB ç®¡ç†æœå‹™
â”‚   â”‚   â””â”€â”€ chat_service.py             # ğŸ’¬ å°è©±æµç¨‹ç·¨æ’
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ models/
â”‚   â”‚   â””â”€â”€ schemas.py                  # ğŸ“‹ Pydantic è³‡æ–™æ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ config/
â”‚   â”‚   â””â”€â”€ prompts.py                  # ğŸ“ Prompt æ¨¡æ¿
â”‚   â”‚
â”‚   â”œâ”€â”€ main.py                         # â­ FastAPI ä¸»æ‡‰ç”¨
â”‚   â”œâ”€â”€ requirements.txt                # Python ä¾è³´
â”‚   â”œâ”€â”€ .env.example                    # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”‚   â”œâ”€â”€ .gitignore                      # Git å¿½ç•¥è¦å‰‡
â”‚   â”œâ”€â”€ README.md                       # å¾Œç«¯èªªæ˜æ–‡ä»¶
â”‚   â””â”€â”€ SETUP_GUIDE.md                  # è¨­å®šæŒ‡å—
â”‚
â”œâ”€â”€ ğŸ“ reference/                       # ğŸ“š åƒè€ƒå¯¦ä½œï¼ˆPythonï¼‰
â”‚   â”œâ”€â”€ prompts.py                      # åŸå§‹ Prompt æ¨¡æ¿
â”‚   â”œâ”€â”€ put_ptkb.py                     # åŸå§‹ PTKB é‚è¼¯
â”‚   â””â”€â”€ put_response.py                 # åŸå§‹å°è©±é‚è¼¯
â”‚
â”œâ”€â”€ README.md                           # â­ å°ˆæ¡ˆç¸½è¦½
â”œâ”€â”€ QUICK_START.md                      # ğŸš€ å¿«é€Ÿé–‹å§‹æŒ‡å—
â”œâ”€â”€ FRONTEND_CLEANUP_COMPLETE.md        # ğŸ“‹ å‰ç«¯æ¸…ç†ç¸½çµ
â”œâ”€â”€ BACKEND_IMPLEMENTATION_COMPLETE.md  # ğŸ“‹ å¾Œç«¯å¯¦ä½œç¸½çµ
â””â”€â”€ PROJECT_STRUCTURE.md                # ğŸ“‚ æ­¤æª”æ¡ˆ
```

## ğŸ”„ è³‡æ–™æµç¨‹

### ä½¿ç”¨è€…ç™¼é€è¨Šæ¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä½¿ç”¨è€…    â”‚
â”‚ (ç€è¦½å™¨)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. è¼¸å…¥è¨Šæ¯
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend (Next.js)                 â”‚
â”‚  http://localhost:3000              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ChatInput.tsx                      â”‚
â”‚    â””â”€> SimpleChatContext            â”‚
â”‚         â””â”€> api.sendChatMessage()   â”‚
â”‚              â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ 2. HTTP POST
               â”‚    /api/chat
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend (FastAPI)                  â”‚
â”‚  http://localhost:8000              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  main.py (CORS, Routes)             â”‚
â”‚    â””â”€> chat.py (API Route)          â”‚
â”‚         â””â”€> chat_service.py         â”‚
â”‚              â”œâ”€> ptkb_service.py    â”‚
â”‚              â”‚    â”œâ”€> extractNewPTKBâ”‚
â”‚              â”‚    â””â”€> getRelevantPTKBsâ”‚
â”‚              â”‚                      â”‚
â”‚              â””â”€> gemini_client.py   â”‚
â”‚                   â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ 3. API Call
                    â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Gemini API   â”‚
               â”‚ (Google)     â”‚
               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ 4. AI å›æ‡‰
                      â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   å›å‚³è·¯å¾‘   â”‚
               â”‚  (ç›¸åæ–¹å‘)  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”‘ æ ¸å¿ƒæª”æ¡ˆèªªæ˜

### å‰ç«¯

| æª”æ¡ˆ | è·è²¬ | é‡è¦ç¨‹åº¦ |
|------|------|----------|
| `frontend/src/lib/api.ts` | èˆ‡å¾Œç«¯é€šä¿¡çš„ API å®¢æˆ¶ç«¯ | â­â­â­ |
| `frontend/src/contexts/SimpleChatContext.tsx` | ç®¡ç†èŠå¤©ç‹€æ…‹å’Œæ­·å² | â­â­â­ |
| `frontend/src/components/chat-panel/ChatInput.tsx` | ä½¿ç”¨è€…è¼¸å…¥ä»‹é¢ | â­â­ |
| `frontend/src/components/chat-panel/ChatHistory.tsx` | é¡¯ç¤ºå°è©±æ­·å² | â­â­ |
| `frontend/src/types/index.ts` | TypeScript é¡å‹å®šç¾© | â­â­ |

### å¾Œç«¯

| æª”æ¡ˆ | è·è²¬ | é‡è¦ç¨‹åº¦ |
|------|------|----------|
| `backend/main.py` | FastAPI æ‡‰ç”¨å…¥å£ï¼ŒCORS è¨­å®š | â­â­â­ |
| `backend/api/routes/chat.py` | /api/chat ç«¯é»è™•ç† | â­â­â­ |
| `backend/services/chat_service.py` | å°è©±æµç¨‹ç·¨æ’ï¼ˆæ ¸å¿ƒé‚è¼¯ï¼‰ | â­â­â­ |
| `backend/services/gemini_client.py` | Gemini API å°è£ | â­â­â­ |
| `backend/services/ptkb_service.py` | PTKB æå–èˆ‡ç¯©é¸ | â­â­â­ |
| `backend/models/schemas.py` | Pydantic è³‡æ–™æ¨¡å‹ | â­â­ |
| `backend/config/prompts.py` | Prompt æ¨¡æ¿ | â­â­ |

## ğŸ¨ å…ƒä»¶æ¨¹ç‹€åœ–

### å‰ç«¯å…ƒä»¶éšå±¤

```
Providers.tsx
â”œâ”€ NextThemesProvider (ä¸»é¡Œ)
â”‚  â””â”€ ExplainProvider
â”‚     â””â”€ DocumentProvider
â”‚        â””â”€ SimpleChatProvider â­ (èŠå¤©ç‹€æ…‹)
â”‚           â”œâ”€ page.tsx (ä¸»é é¢)
â”‚           â”‚  â”œâ”€ Header
â”‚           â”‚  â”‚  â””â”€ ThemeToggle
â”‚           â”‚  â”‚
â”‚           â”‚  â”œâ”€ DocumentPanel (å·¦å´æ¬„ï¼Œæœªä¾†åŠŸèƒ½)
â”‚           â”‚  â”‚  â”œâ”€ FileUploader
â”‚           â”‚  â”‚  â””â”€ FileList
â”‚           â”‚  â”‚
â”‚           â”‚  â”œâ”€ ChatPanel (ä¸­é–“ä¸»è¦å€åŸŸ) â­
â”‚           â”‚  â”‚  â”œâ”€ ChatHistory
â”‚           â”‚  â”‚  â”‚  â””â”€ MessageBubble (å¤šå€‹)
â”‚           â”‚  â”‚  â”‚     â””â”€ CitationBadge (æœªä¾†)
â”‚           â”‚  â”‚  â”‚
â”‚           â”‚  â”‚  â””â”€ ChatInput â­
â”‚           â”‚  â”‚
â”‚           â”‚  â””â”€ ExplainPanel (å³å´æ¬„ï¼Œæœªä¾†åŠŸèƒ½)
â”‚           â”‚     â”œâ”€ RewrittenQuery
â”‚           â”‚     â””â”€ RetrievedPassages
â”‚           â”‚
â”‚           â””â”€ Toaster (é€šçŸ¥)
```

## ğŸ’¡ è¨­è¨ˆæ¨¡å¼

### å‰ç«¯

- **ç‹€æ…‹ç®¡ç†**ï¼šReact Context API
- **UI å…ƒä»¶**ï¼šshadcn/ui (åŸºæ–¼ Radix UI)
- **æ¨£å¼**ï¼šTailwind CSS
- **è·¯ç”±**ï¼šNext.js App Router
- **è³‡æ–™ç²å–**ï¼šFetch API

### å¾Œç«¯

- **æ¶æ§‹**ï¼šåˆ†å±¤æ¶æ§‹ï¼ˆRoutes â†’ Services â†’ Clientsï¼‰
- **è³‡æ–™é©—è­‰**ï¼šPydantic
- **API æ–‡ä»¶**ï¼šFastAPI è‡ªå‹•ç”Ÿæˆ
- **éŒ¯èª¤è™•ç†**ï¼šTry-Catch + é‡è©¦æ©Ÿåˆ¶
- **è¨­å®šç®¡ç†**ï¼šç’°å¢ƒè®Šæ•¸ (.env)

## ğŸ”— API ä»‹é¢å¥‘ç´„

### POST /api/chat

**è«‹æ±‚ï¼š**
```typescript
{
  query: string;              // ä½¿ç”¨è€…æŸ¥è©¢
  conversation_id?: string;   // å°è©± IDï¼ˆå¯é¸ï¼‰
  history?: Array<{           // å°è©±æ­·å²ï¼ˆå¯é¸ï¼‰
    role: "user" | "assistant";
    content: string;
  }>;
  ptkb_list?: string[];       // PTKB åˆ—è¡¨ï¼ˆå¯é¸ï¼‰
}
```

**å›æ‡‰ï¼š**
```typescript
{
  answer: string;             // AI å›æ‡‰
  conversation_id: string;    // å°è©± ID
  ptkb_used: string[];        // ä½¿ç”¨çš„ PTKB
  new_ptkb?: string;          // æ–°æå–çš„ PTKBï¼ˆå¯é¸ï¼‰
}
```

## ğŸ›£ï¸ é–‹ç™¼è·¯ç·šåœ–

### âœ… å·²å®Œæˆ

- [x] å‰å¾Œç«¯åˆ†é›¢æ¶æ§‹
- [x] åŸºæœ¬å°è©±åŠŸèƒ½
- [x] PTKB è‡ªå‹•æå–èˆ‡æ‡‰ç”¨
- [x] å¤šè¼ªå°è©±æ”¯æ´
- [x] å€‹äººåŒ–å›æ‡‰
- [x] æ·±æ·ºä¸»é¡Œåˆ‡æ›
- [x] éŸ¿æ‡‰å¼è¨­è¨ˆ

### ğŸš§ é€²è¡Œä¸­

- [ ] ä¿®å¾© Next.js 16 Turbopack ä¸­æ–‡è·¯å¾‘å•é¡Œ
- [ ] å®Œå–„éŒ¯èª¤è™•ç†

### ğŸ“‹ æœªä¾†åŠŸèƒ½

- [ ] æ–‡ä»¶ä¸Šå‚³èˆ‡ç´¢å¼•
- [ ] IR æª¢ç´¢æ•´åˆ
- [ ] å¼•æ–‡æ¨™è¨»ç³»çµ±
- [ ] å¯è§£é‡‹æ€§é¢æ¿
- [ ] è³‡æ–™åº«æŒä¹…åŒ–
- [ ] ä½¿ç”¨è€…èªè­‰
- [ ] å¤šä½¿ç”¨è€…æ”¯æ´
- [ ] Docker å®¹å™¨åŒ–
- [ ] éƒ¨ç½²åˆ°é›²ç«¯

## ğŸ“Š æŠ€è¡“æ£§ç¸½è¦½

### å‰ç«¯æŠ€è¡“

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Next.js | 16.0.7 | React æ¡†æ¶ |
| React | 19.2.0 | UI å‡½å¼åº« |
| TypeScript | ^5 | é¡å‹ç³»çµ± |
| Tailwind CSS | ^4 | CSS æ¡†æ¶ |
| shadcn/ui | - | UI å…ƒä»¶åº« |
| next-themes | ^0.4.6 | ä¸»é¡Œç®¡ç† |
| lucide-react | ^0.555.0 | åœ–ç¤ºåº« |

### å¾Œç«¯æŠ€è¡“

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Python | 3.8+ | ç¨‹å¼èªè¨€ |
| FastAPI | ^0.115.12 | Web æ¡†æ¶ |
| Pydantic | ^2.10.6 | è³‡æ–™é©—è­‰ |
| Uvicorn | ^0.34.0 | ASGI ä¼ºæœå™¨ |
| google-generativeai | ^0.8.6 | Gemini API SDK |
| python-dotenv | ^1.0.1 | ç’°å¢ƒè®Šæ•¸ç®¡ç† |

## ğŸ“– ç›¸é—œæ–‡ä»¶é€£çµ

- [å°ˆæ¡ˆç¸½è¦½](README.md)
- [å¿«é€Ÿé–‹å§‹](QUICK_START.md)
- [å‰ç«¯æ–‡ä»¶](frontend/README.md)
- [å¾Œç«¯æ–‡ä»¶](backend/README.md)
- [å¾Œç«¯è¨­å®š](backend/SETUP_GUIDE.md)
- [å‰ç«¯æ¸…ç†](FRONTEND_CLEANUP_COMPLETE.md)
- [å¾Œç«¯å¯¦ä½œ](BACKEND_IMPLEMENTATION_COMPLETE.md)

---

**æ›´æ–°æ—¥æœŸ**ï¼š2024/12/16  
**ç¶­è­·è€…**ï¼šIRTM 2025 Group 1


